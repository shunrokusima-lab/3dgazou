<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>ç¾å ´Navi 3D - çµ±åˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
  
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.110/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.110/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css"/>
  <script src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>

  <style>
    body { margin: 0; padding: 0; overflow: hidden; font-family: 'Hiragino Kaku Gothic ProN', sans-serif; }
    #cesiumContainer { width: 100%; height: 100vh; }
    
    /* å†™çœŸãƒ»ãƒ‘ãƒãƒ©ãƒè¡¨ç¤ºç”¨ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ */
    #pano-container {
      display: none; position: fixed; top: 50%; left: 50%;
      transform: translate(-50%, -50%); width: 85%; height: 75%;
      background: #000; z-index: 1000; border: 4px solid #fff;
      box-shadow: 0 0 50px rgba(0,0,0,0.9);
    }
    
    #panorama, #regular-photo { width: 100%; height: 100%; }
    #regular-photo { display: none; object-fit: contain; background: #1a1a1a; }

    #close-btn {
      position: absolute; top: 12px; right: 12px; z-index: 1001;
      background: #e74c3c; color: white; border: none; padding: 12px 24px;
      cursor: pointer; font-weight: bold; border-radius: 4px; font-size: 16px;
    }

    /* æ¡ˆå†…ãƒ‘ãƒãƒ«ï¼ˆå‡¡ä¾‹ï¼‰ */
    #info-panel {
      position: absolute; top: 20px; left: 20px; background: rgba(25, 25, 25, 0.9);
      color: white; padding: 18px; border-radius: 10px; z-index: 500; font-size: 14px;
      line-height: 1.8; border-left: 6px solid #3498db;
    }

    /* ãƒ‘ãƒãƒ©ãƒå†…ï¼šå¯¸æ³•è¡¨ç¤ºãƒ©ãƒ™ãƒ« */
    .dimension-label {
        background-color: rgba(255, 235, 59, 0.95);
        color: #c0392b;
        border: 2px solid #c0392b;
        padding: 4px 10px;
        font-size: 15px;
        font-weight: bold;
        border-radius: 4px;
        box-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }
  </style>
</head>

<body>
  <div id="info-panel">
    <b style="font-size: 16px;">ã€ç¾å ´Navi 3Dã€‘</b><br>
    <span style="color: #3498db;">â– </span> <b>é’æ ã‚¨ãƒªã‚¢</b>ï¼šè¨ˆç”»æ•·åœ°ï¼ˆåŠé€æ˜ï¼‰<br>
    ğŸ“ <b>èµ¤ãƒ”ãƒ³</b>ï¼š360Â°ãƒ‘ãƒãƒ©ãƒç”»åƒ<br>
    ğŸ“· <b>ã‚«ãƒ¡ãƒ©</b>ï¼šæ–½å·¥å†™çœŸ(å˜ä½“)<br>
    ğŸ“ <b>ãƒãƒ¼ãƒˆ</b>ï¼šç®¡ç†ãƒ¡ãƒ¢<br>
    <hr style="border: 0; border-top: 1px solid #555; margin: 10px 0;">
    <small>â€»ãƒãƒƒãƒ—ã‚’ã‚¯ãƒªãƒƒã‚¯ã§åº§æ¨™ã‚’å–å¾—(F12)</small>
  </div>
  
  <div id="cesiumContainer"></div>
  
  <div id="pano-container">
    <button id="close-btn" onclick="closePano()">Ã— é–‰ã˜ã‚‹</button>
    <div id="panorama"></div>
    <img id="regular-photo" src="">
  </div>

  <script>
    // ==============================================
    // 1. åŸºæœ¬è¨­å®šï¼ˆã‚­ãƒ¼ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ï¼‰
    // ==============================================
    const CESIUM_TOKEN = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJhNGNjZDY5Ni00OTZmLTRkYjUtOWU0Yi02NTYzYmZmYTQzYWMiLCJpZCI6Mzc5MDEzLCJpYXQiOjE3Njg0NzM2MjR9.FKr4TDitEebTSNkEdy_VJ0NjYNkGfztPrcf1VDyBs30'; 
    const GOOGLE_API_KEY = 'AIzaSyAaEXs0u7x4V2k_elvzlEJTWPkJoCYuLGU';

    const ICONS = {
        '360': 'https://img.icons8.com/color/48/marker.png',
        'photo': 'https://img.icons8.com/fluency/48/camera.png',
        'memo': 'https://img.icons8.com/color/48/note.png',
        'default': 'https://img.icons8.com/color/48/marker.png'
    };

    Cesium.Ion.defaultAccessToken = CESIUM_TOKEN;
    const viewer = new Cesium.Viewer('cesiumContainer', {
      baseLayerPicker: false, timeline: false, animation: false,
      geocoder: false, homeButton: false, sceneModePicker: false
    });

    async function initMap() {
      try {
        const tileset = await Cesium.createGooglePhotorealistic3DTileset(GOOGLE_API_KEY);
        viewer.scene.primitives.add(tileset);
        
        // åˆæœŸã®è¦–ç‚¹è¨­å®šï¼ˆç·¯åº¦, çµŒåº¦, é«˜åº¦ï¼‰
        viewer.camera.flyTo({
          destination: Cesium.Cartesian3.fromDegrees(135.5625, 34.5193, 600),
          orientation: { pitch: Cesium.Math.toRadians(-35.0) }
        });
      } catch (e) { console.error(e); }
    }
    initMap();

    // ==============================================
    // 2. æ•·åœ°å¢ƒç•Œãƒ»åœ°ç‚¹è¿½åŠ é–¢æ•°
    // ==============================================

    // æ•·åœ°å¢ƒç•Œã‚’æç”»ï¼ˆå¡—ã‚Šã¤ã¶ã—ã‚’åŠé€æ˜ã«ã™ã‚‹è¨­å®šæ¸ˆã¿ï¼‰
    function addSiteBoundary(coords, color) {
      viewer.entities.add({
        polygon: {
          hierarchy: Cesium.Cartesian3.fromDegreesArray(coords),
          // ã€é‡è¦ã€‘alpha: 0.3ï¼ˆ30%ã®é€æ˜åº¦ï¼‰ã«è¨­å®š
          material: color.withAlpha(0.3),
          classificationType: Cesium.ClassificationType.BOTH
        },
        polyline: {
          positions: Cesium.Cartesian3.fromDegreesArray(coords.concat([coords[0], coords[1]])),
          width: 5,
          material: color,
          clampToGround: true,
          classificationType: Cesium.ClassificationType.BOTH
        }
      });
    }

    // ãƒ”ãƒ³ãƒ»ã‚«ãƒ¡ãƒ©åœ°ç‚¹ã‚’è¿½åŠ 
    function addPoint(lat, lon, height, name, type, imgFile, hotspots = []) {
      const iconImage = ICONS[type] || ICONS['default'];
      const entity = viewer.entities.add({
        position: Cesium.Cartesian3.fromDegrees(lon, lat, height),
        billboard: {
          image: iconImage, verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
          heightReference: Cesium.HeightReference.RELATIVE_TO_GROUND,
          width: 42, height: 42,
          disableDepthTestDistance: Number.POSITIVE_INFINITY // å»ºç‰©ã«åŸ‹ã‚‚ã‚Œãªã„
        },
        name: name
      });
      entity.customData = { type: type, url: `./${imgFile}`, hotspots: hotspots };
    }

    // ==============================================
    // 3. ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆã‚¯ãƒªãƒƒã‚¯å‡¦ç†ï¼‰
    // ==============================================
    const handler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);
    let panoViewer = null;

    handler.setInputAction(function(click) {
      const picked = viewer.scene.pick(click.position);
      
      if (Cesium.defined(picked) && picked.id && picked.id.customData) {
        const data = picked.id.customData;
        document.getElementById('pano-container').style.display = 'block';

        if (data.type === '360') {
          document.getElementById('panorama').style.display = 'block';
          document.getElementById('regular-photo').style.display = 'none';
          if (panoViewer) panoViewer.destroy();
          panoViewer = pannellum.viewer('panorama', {
            "type": "equirectangular", "panorama": data.url, "autoLoad": true,
            "hotSpots": data.hotspots, "hotSpotDebug": true
          });
        } else if (data.type === 'photo') {
          document.getElementById('panorama').style.display = 'none';
          document.getElementById('regular-photo').style.display = 'block';
          document.getElementById('regular-photo').src = data.url;
        }
      } else {
        const cartesian = viewer.scene.pickPosition(click.position);
        if (cartesian) {
          const carto = Cesium.Cartographic.fromCartesian(cartesian);
          // F12ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«çµŒåº¦, ç·¯åº¦ã®é †ã§å‡ºåŠ›ï¼ˆã‚³ãƒ”ãƒšç”¨ï¼‰
          console.log(`${Cesium.Math.toDegrees(carto.longitude).toFixed(6)}, ${Cesium.Math.toDegrees(carto.latitude).toFixed(6)}`);
        }
      }
    }, Cesium.ScreenSpaceEventType.LEFT_CLICK);

    function closePano() {
      document.getElementById('pano-container').style.display = 'none';
      if (panoViewer) panoViewer.destroy();
      document.getElementById('regular-photo').src = "";
    }

    // ==============================================
    // 4. ãƒ‡ãƒ¼ã‚¿ç™»éŒ²ã‚¨ãƒªã‚¢ï¼ˆã“ã“ã‚’æ›¸ãæ›ãˆã¦ãã ã•ã„ï¼‰
    // ==============================================

    // ã€æ•·åœ°å¢ƒç•Œï¼šçµŒåº¦, ç·¯åº¦ã®é †ã§è§’ã®åº§æ¨™ã‚’ä¸¦ã¹ã‚‹ã€‘
    const siteArea = [
        135.561800, 34.518800,
        135.563200, 34.518800,
        135.563200, 34.520200,
        135.561800, 34.520200
    ];
    addSiteBoundary(siteArea, Cesium.Color.SKYBLUE);

    // ã€360åº¦ãƒ‘ãƒãƒ©ãƒï¼šèµ¤ãƒ”ãƒ³ã€‘
    addPoint(34.519329, 135.562531, 98.0, "ãƒ†ã‚¹ãƒˆãƒ‘ãƒãƒ©ãƒåœ°ç‚¹", "360", "view01.JPG", [
        { pitch: -10, yaw: 170, text: "æ¢ä¸‹: 2,800mm", cssClass: "dimension-label" }
    ]);

    // 1åœ°ç‚¹ç›®
    addPoint(34.517793, 135.562679, 95.66, "ç”»åƒâ‘ ", "photo", "IMG_0433.PNG", []);

    // 2åœ°ç‚¹ç›®
    addPoint(34.517329, 135.562961, 98.06, "ç”»åƒâ‘¡", "photo", "IMG_0434.PNG", []);

    // 3åœ°ç‚¹ç›®
    addPoint(34.517610, 135.562945, 96.54, "ç”»åƒâ‘¢", "photo", "IMG_0435.PNG", []);

    // 4åœ°ç‚¹ç›®
    addPoint(34.518484, 135.562452, 95.21, "ç”»åƒâ‘£", "photo", "IMG_0436.PNG", []);

    // 5åœ°ç‚¹ç›®
    addPoint(34.518573, 135.562393, 95.05, "ç”»åƒâ‘¤", "photo", "IMG_0437.PNG", []);

    // 6åœ°ç‚¹ç›®
    addPoint(34.519045, 135.562227, 94.62, "ç”»åƒâ‘¥", "photo", "IMG_0438.PNG", []);

    // 7åœ°ç‚¹ç›®
    addPoint(34.520433, 135.562157, 94.36, "ç”»åƒâ‘¦", "photo", "IMG_0439.PNG", []);

    // 8åœ°ç‚¹ç›®
    addPoint(34.520422, 135.561945, 94.31, "ç”»åƒâ‘§", "photo", "IMG_0440.PNG", []);

ã€€ã€€// 9åœ°ç‚¹ç›®
    addPoint(34.518007, 135.562379, 96.87, "360åº¦1", "default", "1.JPG", []);

    // 10åœ°ç‚¹ç›®
    addPoint(34.518116, 135.561823, 98.94, "360åº¦2", "default", "2.JPG", []);

    // 11åœ°ç‚¹ç›®
    addPoint(34.519276, 135.561624, 99.21, "360åº¦3", "default", "3.JPG", []);

    // 12åœ°ç‚¹ç›®
    addPoint(34.519273, 135.561905, 99.63, "360åº¦4", "default", "4.JPG", []);

    // 13åœ°ç‚¹ç›®
    addPoint(34.519294, 135.562324, 99.60, "360åº¦5", "default", "5.JPG", []);

    // 14åœ°ç‚¹ç›®
    addPoint(34.519005, 135.562643, 98.15, "360åº¦6", "default", "6.JPG", []);

    // 15åœ°ç‚¹ç›®
    addPoint(34.518703, 135.562626, 99.14, "360åº¦7", "default", "7.JPG", []);

    // 16åœ°ç‚¹ç›®
    addPoint(34.518638, 135.562783, 99.06, "360åº¦8", "default", "8.JPG", []);

    // 17åœ°ç‚¹ç›®
    addPoint(34.518721, 135.562922, 98.95, "360åº¦9", "default", "9.JPG", []);

    // 18åœ°ç‚¹ç›®
    addPoint(34.518932, 135.562879, 98.75, "360åº¦10", "default", "10.JPG", []);

    // 19åœ°ç‚¹ç›®
    addPoint(34.519686, 135.562554, 97.22, "360åº¦11", "default", "11.JPG", []);

    // 20åœ°ç‚¹ç›®
    addPoint(34.520166, 135.562517, 97.39, "360åº¦12", "default", "12.JPG", []);

    // 21åœ°ç‚¹ç›®
    addPoint(34.519261, 135.562070, 99.74, "360åº¦13", "default", "13.JPG", []);

    // 22åœ°ç‚¹ç›®
    addPoint(34.518478, 135.562445, 95.21, "360åº¦14", "default", "14.JPG", []);
 
    // 23åœ°ç‚¹ç›®
    addPoint(34.518729, 135.562317, 95.10, "360åº¦15", "default", "15.JPG", []);

    // 24åœ°ç‚¹ç›®
    addPoint(34.520384, 135.561967, 94.33, "360åº¦16", "default", "16.JPG", []);
 
    // 25åœ°ç‚¹ç›®
    addPoint(34.517855, 135.562653, 95.64, "360åº¦17", "default", "17.JPG", []);

    // 26åœ°ç‚¹ç›®
    addPoint(34.519481, 135.561595, 95.46, "360åº¦18", "default", "18.JPG", []);

    // 25åœ°ç‚¹ç›®
    addPoint(34.519039, 135.562231, 94.66, "360åº¦19", "default", "19.JPG", []);

    // 26åœ°ç‚¹ç›®
    addPoint(34.517296, 135.562873, 97.87, "360åº¦21", "default", "21.JPG", []);

    // 27åœ°ç‚¹ç›®
    addPoint(34.520435, 135.562154, 94.38, "360åº¦22", "default", "22.JPG", []);

    // 28åœ°ç‚¹ç›®
    addPoint(34.517363, 135.563045, 97.94, "360åº¦23", "default", "23.JPG", []);


  </script>
</body>
</html>